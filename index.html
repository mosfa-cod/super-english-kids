 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ“ Super English Kids!</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>"/>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>

  <!-- React + Babel (no build needed) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #fff9f0; }
    @keyframes bounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-9px)} }
    @keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
    @keyframes pop    { 0%{transform:scale(.8);opacity:0} 60%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }
    .wcard:hover { transform: translateY(-4px) scale(1.04) !important; }
    .tbtn:hover  { opacity: .85; }
    ::-webkit-scrollbar { width: 6px }
    ::-webkit-scrollbar-thumb { background: #c9b8ff; border-radius: 3px }
  </style>
</head>
<body>
    <h1>Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø¯Ø­Ø±ÙˆØ¬</h1>

  <div id="root"></div>
  

  <script type="text/babel">
  const { useState, useEffect, useRef, useCallback } = React;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  DATA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const WORDS = {
    animals:[
      {en:'Cat',ar:'Ù‚Ø·Ø©',e:'ğŸ±'},{en:'Dog',ar:'ÙƒÙ„Ø¨',e:'ğŸ¶'},{en:'Lion',ar:'Ø£Ø³Ø¯',e:'ğŸ¦'},
      {en:'Elephant',ar:'ÙÙŠÙ„',e:'ğŸ˜'},{en:'Rabbit',ar:'Ø£Ø±Ù†Ø¨',e:'ğŸ°'},{en:'Fish',ar:'Ø³Ù…ÙƒØ©',e:'ğŸŸ'},
      {en:'Bird',ar:'Ø·Ø§Ø¦Ø±',e:'ğŸ¦'},{en:'Monkey',ar:'Ù‚Ø±Ø¯',e:'ğŸ’'},{en:'Horse',ar:'Ø­ØµØ§Ù†',e:'ğŸ´'},
      {en:'Frog',ar:'Ø¶ÙØ¯Ø¹',e:'ğŸ¸'},{en:'Cow',ar:'Ø¨Ù‚Ø±Ø©',e:'ğŸ„'},{en:'Duck',ar:'Ø¨Ø·Ø©',e:'ğŸ¦†'},
    ],
    food:[
      {en:'Apple',ar:'ØªÙØ§Ø­Ø©',e:'ğŸ'},{en:'Banana',ar:'Ù…ÙˆØ²Ø©',e:'ğŸŒ'},{en:'Pizza',ar:'Ø¨ÙŠØªØ²Ø§',e:'ğŸ•'},
      {en:'Cake',ar:'ÙƒÙŠÙƒØ©',e:'ğŸ‚'},{en:'Milk',ar:'Ù„Ø¨Ù†',e:'ğŸ¥›'},{en:'Egg',ar:'Ø¨ÙŠØ¶Ø©',e:'ğŸ¥š'},
      {en:'Bread',ar:'Ø¹ÙŠØ´',e:'ğŸ'},{en:'Cookie',ar:'Ø¨Ø³ÙƒÙˆÙŠØª',e:'ğŸª'},{en:'Juice',ar:'Ø¹ØµÙŠØ±',e:'ğŸ§ƒ'},
      {en:'Watermelon',ar:'Ø¨Ø·ÙŠØ®',e:'ğŸ‰'},{en:'Cheese',ar:'Ø¬Ø¨Ù†Ø©',e:'ğŸ§€'},{en:'Ice Cream',ar:'Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…',e:'ğŸ¦'},
    ],
    colors:[
      {en:'Red',ar:'Ø£Ø­Ù…Ø±',e:'ğŸ”´'},{en:'Blue',ar:'Ø£Ø²Ø±Ù‚',e:'ğŸ”µ'},{en:'Green',ar:'Ø£Ø®Ø¶Ø±',e:'ğŸŸ¢'},
      {en:'Yellow',ar:'Ø£ØµÙØ±',e:'ğŸŸ¡'},{en:'Orange',ar:'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ',e:'ğŸŸ '},{en:'Purple',ar:'Ø¨Ù†ÙØ³Ø¬ÙŠ',e:'ğŸŸ£'},
      {en:'Pink',ar:'ÙˆØ±Ø¯ÙŠ',e:'ğŸ©·'},{en:'White',ar:'Ø£Ø¨ÙŠØ¶',e:'â¬œ'},{en:'Black',ar:'Ø£Ø³ÙˆØ¯',e:'â¬›'},
      {en:'Brown',ar:'Ø¨Ù†ÙŠ',e:'ğŸŸ«'},{en:'Gold',ar:'Ø°Ù‡Ø¨ÙŠ',e:'ğŸ¥‡'},{en:'Silver',ar:'ÙØ¶ÙŠ',e:'ğŸ¥ˆ'},
    ],
    school:[
      {en:'Pencil',ar:'Ù‚Ù„Ù… Ø±ØµØ§Øµ',e:'âœï¸'},{en:'Book',ar:'ÙƒØªØ§Ø¨',e:'ğŸ“š'},{en:'Bag',ar:'Ø´Ù†Ø·Ø©',e:'ğŸ’'},
      {en:'Ruler',ar:'Ù…Ø³Ø·Ø±Ø©',e:'ğŸ“'},{en:'Chair',ar:'ÙƒØ±Ø³ÙŠ',e:'ğŸª‘'},{en:'Table',ar:'ØªØ±Ø§Ø¨ÙŠØ²Ø©',e:'ğŸªµ'},
      {en:'Teacher',ar:'Ù…Ø¹Ù„Ù…',e:'ğŸ‘¨â€ğŸ«'},{en:'Eraser',ar:'Ù…Ù…Ø­Ø§Ø©',e:'ğŸ§¹'},{en:'Scissors',ar:'Ù…Ù‚Øµ',e:'âœ‚ï¸'},
      {en:'Paint',ar:'Ø£Ù„ÙˆØ§Ù†',e:'ğŸ¨'},{en:'Globe',ar:'ÙƒØ±Ø© Ø£Ø±Ø¶ÙŠØ©',e:'ğŸŒ'},{en:'Calculator',ar:'Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©',e:'ğŸ§®'},
    ],
    numbers:[
      {en:'One',ar:'ÙˆØ§Ø­Ø¯',e:'1ï¸âƒ£'},{en:'Two',ar:'Ø§ØªÙ†ÙŠÙ†',e:'2ï¸âƒ£'},{en:'Three',ar:'ØªÙ„Ø§ØªØ©',e:'3ï¸âƒ£'},
      {en:'Four',ar:'Ø£Ø±Ø¨Ø¹Ø©',e:'4ï¸âƒ£'},{en:'Five',ar:'Ø®Ù…Ø³Ø©',e:'5ï¸âƒ£'},{en:'Six',ar:'Ø³ØªØ©',e:'6ï¸âƒ£'},
      {en:'Seven',ar:'Ø³Ø¨Ø¹Ø©',e:'7ï¸âƒ£'},{en:'Eight',ar:'ØªÙ…Ø§Ù†ÙŠØ©',e:'8ï¸âƒ£'},{en:'Nine',ar:'ØªØ³Ø¹Ø©',e:'9ï¸âƒ£'},
      {en:'Ten',ar:'Ø¹Ø´Ø±Ø©',e:'ğŸ”Ÿ'},{en:'Zero',ar:'ØµÙØ±',e:'0ï¸âƒ£'},{en:'Hundred',ar:'Ù…ÙŠØ©',e:'ğŸ’¯'},
    ],
    body:[
      {en:'Eye',ar:'Ø¹ÙŠÙ†',e:'ğŸ‘ï¸'},{en:'Ear',ar:'ÙˆØ¯Ù†',e:'ğŸ‘‚'},{en:'Nose',ar:'Ø£Ù†Ù',e:'ğŸ‘ƒ'},
      {en:'Hand',ar:'Ø¥ÙŠØ¯',e:'âœ‹'},{en:'Foot',ar:'Ø±Ø¬Ù„',e:'ğŸ¦¶'},{en:'Head',ar:'Ø±Ø£Ø³',e:'ğŸ—£ï¸'},
      {en:'Heart',ar:'Ù‚Ù„Ø¨',e:'â¤ï¸'},{en:'Mouth',ar:'Ø¨Ù‚',e:'ğŸ‘„'},{en:'Teeth',ar:'Ø³Ù†Ø§Ù†',e:'ğŸ¦·'},
      {en:'Hair',ar:'Ø´Ø¹Ø±',e:'ğŸ’‡'},{en:'Arm',ar:'Ø¯Ø±Ø§Ø¹',e:'ğŸ’ª'},{en:'Finger',ar:'ØµØ¨Ø¹',e:'â˜ï¸'},
    ],
    home:[
      {en:'Door',ar:'Ø¨Ø§Ø¨',e:'ğŸšª'},{en:'Window',ar:'Ø´Ø¨Ø§Ùƒ',e:'ğŸªŸ'},{en:'Bed',ar:'Ø³Ø±ÙŠØ±',e:'ğŸ›ï¸'},
      {en:'Sofa',ar:'Ø£Ø±ÙŠÙƒØ©',e:'ğŸ›‹ï¸'},{en:'TV',ar:'ØªÙ„ÙØ²ÙŠÙˆÙ†',e:'ğŸ“º'},{en:'Phone',ar:'ØªÙ„ÙŠÙÙˆÙ†',e:'ğŸ“±'},
      {en:'Cup',ar:'ÙƒÙˆØ¨Ø§ÙŠØ©',e:'â˜•'},{en:'Clock',ar:'Ø³Ø§Ø¹Ø©',e:'ğŸ•'},{en:'Lamp',ar:'Ù„Ù…Ø¨Ø©',e:'ğŸ’¡'},
      {en:'Mirror',ar:'Ù…Ø±Ø§ÙŠØ§',e:'ğŸª'},{en:'Key',ar:'Ù…ÙØªØ§Ø­',e:'ğŸ”‘'},{en:'Fan',ar:'Ù…Ø±ÙˆØ­Ø©',e:'ğŸ’¨'},
    ],
  };

  const CAT_NAMES = {
    animals:'ğŸ¾ Ø­ÙŠÙˆØ§Ù†Ø§Øª', food:'ğŸ Ø£ÙƒÙ„', colors:'ğŸ¨ Ø£Ù„ÙˆØ§Ù†',
    school:'ğŸ’ Ù…Ø¯Ø±Ø³Ø©', numbers:'ğŸ”¢ Ø£Ø±Ù‚Ø§Ù…', body:'ğŸ«€ Ø¬Ø³Ù…', home:'ğŸ  Ø¨ÙŠØª',
  };

  const STORY_TOPICS = {
    adventure:{label:'ğŸ¦ Ù…ØºØ§Ù…Ø±Ø©', en:'a jungle adventure with brave animal friends who learn English together'},
    animals:  {label:'ğŸ¾ Ø­ÙŠÙˆØ§Ù†Ø§Øª',en:'funny animal friends at an English school learning new words every day'},
    space:    {label:'ğŸš€ ÙØ¶Ø§Ø¡',   en:'a space adventure to the moon where aliens learn English'},
    magic:    {label:'ğŸª„ Ø³Ø­Ø±',    en:'a magic school with young wizards who use English spells'},
    ocean:    {label:'ğŸŒŠ Ø¨Ø­Ø±',    en:'an underwater adventure with sea creatures learning English words'},
    family:   {label:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¹ÙŠÙ„Ø©',   en:'a funny family day where everyone learns English phrases together'},
  };

  const PHRASES = [
    {en:'Hello!',ar:'Ù…Ø±Ø­Ø¨Ø§!',e:'ğŸ‘‹'},
    {en:'Good Morning!',ar:'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±!',e:'â˜€ï¸'},
    {en:'Thank you!',ar:'Ø´ÙƒØ±Ø§Ù‹!',e:'ğŸ™'},
    {en:'How are you?',ar:'ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ',e:'ğŸ˜Š'},
    {en:"I'm fine!",ar:'Ø£Ù†Ø§ Ø¨Ø®ÙŠØ±!',e:'âœ¨'},
    {en:'Goodbye!',ar:'ÙˆØ¯Ø§Ø¹Ø§Ù‹!',e:'ğŸ‘‹'},
    {en:'Please!',ar:'Ù…Ù† ÙØ¶Ù„Ùƒ!',e:'ğŸ™'},
    {en:"Let's go!",ar:'ÙŠØ§Ù„Ø§ Ù†Ø±ÙˆØ­!',e:'ğŸš€'},
    {en:'Very good!',ar:'Ù…Ù…ØªØ§Ø²!',e:'â­'},
    {en:'I love you!',ar:'Ø£Ù†Ø§ Ø£Ø­Ø¨Ùƒ!',e:'â¤ï¸'},
    {en:'Well done!',ar:'Ø£Ø­Ø³Ù†Øª!',e:'ğŸ‰'},
    {en:'Be careful!',ar:'Ø§Ù†ØªØ¨Ù‡!',e:'âš ï¸'},
  ];

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  SPEECH  â€” works in real browser (not iframe)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function speak(text, rate = 0.82) {
    const clean = text
      .replace(/[\u0600-\u06FF\u0750-\u077F]+/g, ' ')
      .replace(/[^\w\s.!?,'\-]/g, ' ')
      .replace(/\s+/g, ' ').trim();
    if (!clean) return;

    if (!window.speechSynthesis) return;
    window.speechSynthesis.cancel();

    const say = () => {
      const u = new SpeechSynthesisUtterance(clean);
      u.lang = 'en-US'; u.rate = rate; u.pitch = 1.1; u.volume = 1;
      const voices = window.speechSynthesis.getVoices();
      const v = voices.find(v => v.lang === 'en-US') || voices.find(v => v.lang.startsWith('en'));
      if (v) u.voice = v;
      window.speechSynthesis.speak(u);
    };

    const voices = window.speechSynthesis.getVoices();
    if (voices.length > 0) { say(); }
    else { window.speechSynthesis.onvoiceschanged = () => { say(); }; setTimeout(say, 300); }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  AI  â€” API key stored in localStorage
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function getKey() {
    return localStorage.getItem('ek_api_key') || '';
  }

  async function callAI(system, messages) {
    const key = getKey();
    if (!key) throw new Error('NO_KEY');
    const r = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': key,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-allow-browser': 'true',
      },
      body: JSON.stringify({ model:'claude-haiku-4-5-20251001', max_tokens:600, system, messages }),
    });
    const d = await r.json();
    if (d.error) throw new Error(d.error.message);
    return d.content.map(c => c.text||'').join('');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  STYLES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const S = {
    app: (dark) => ({
      fontFamily:"'Nunito',sans-serif", minHeight:'100vh', padding:'14px',
      background: dark ? '#0d0a1a' : '#fff9f0',
      color:       dark ? '#f0e6ff' : '#2d1b69',
      transition:'background .3s,color .3s',
    }),
    card: (dark) => ({
      background: dark ? '#1a1430' : '#fff', borderRadius:20,
      padding:'16px 18px', marginBottom:14,
      boxShadow:'0 6px 24px rgba(0,0,0,.12)',
      border:`2px solid ${dark?'#2d2050':'#e8d5ff'}`,
    }),
    pill: (bg,color) => ({background:bg,color,borderRadius:50,padding:'5px 14px',fontWeight:800,fontSize:'0.82rem',display:'inline-flex',alignItems:'center',gap:4}),
    btn:  (bg,sh='') => ({padding:'10px 22px',borderRadius:50,border:'none',background:bg,color:'#fff',fontWeight:800,cursor:'pointer',fontFamily:"'Nunito',sans-serif",fontSize:'0.9rem',boxShadow:sh,transition:'transform .15s',outline:'none'}),
    tab:  (active,dark) => ({
      padding:'9px 15px',borderRadius:50,
      border:`2px solid ${dark?'#2d2050':'#e8d5ff'}`,
      background: active ? '#4d96ff' : (dark?'#1a1430':'#fff'),
      color: active ? '#fff' : (dark?'#c9b8ff':'#6b5b95'),
      fontWeight:800,fontSize:'0.82rem',cursor:'pointer',
      fontFamily:"'Nunito',sans-serif",transition:'all .2s',
      boxShadow: active ? '0 4px 14px rgba(77,150,255,.4)' : 'none',
    }),
    cat: (active) => ({
      padding:'5px 12px',borderRadius:50,cursor:'pointer',fontWeight:700,fontSize:'0.78rem',
      fontFamily:"'Nunito',sans-serif",transition:'all .2s',
      border:`2px solid ${active?'#ffd93d':'#e8d5ff'}`,
      background: active ? '#ffd93d' : '#ffe0f0',
      color: active ? '#5a3e00' : '#c2185b',
    }),
    inp: (dark) => ({
      flex:1,padding:'11px 16px',borderRadius:50,outline:'none',
      border:`2px solid ${dark?'#2d2050':'#e8d5ff'}`,
      background:dark?'#1e1638':'#f3eeff',
      color:dark?'#f0e6ff':'#2d1b69',
      fontFamily:"'Nunito',sans-serif",fontSize:'0.9rem',fontWeight:600,
    }),
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  COMPONENTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function Dots() {
    return (
      <div style={{display:'flex',gap:5,padding:'6px 0'}}>
        {[0,1,2].map(i=>(
          <div key={i} style={{
            width:9,height:9,background:'#4d96ff',borderRadius:'50%',
            animation:`bounce 1.2s infinite ${i*0.2}s`,
          }}/>
        ))}
      </div>
    );
  }

  function WordCard({w, dark, onSpeak}) {
    const [glow,setGlow] = useState(false);
    return (
      <div className="wcard" onClick={()=>{setGlow(true);onSpeak(w.en);setTimeout(()=>setGlow(false),1400);}}
        style={{
          background:dark?'#1a1430':'#fff',
          border:`3px solid ${glow?'#6bcb77':'#e8d5ff'}`,
          borderRadius:18,padding:'14px 8px',textAlign:'center',cursor:'pointer',
          transition:'all .2s',
          boxShadow:glow?'0 0 0 8px rgba(107,203,119,.2)':'0 4px 12px rgba(0,0,0,.08)',
          transform:glow?'scale(1.06)':'scale(1)',
        }}>
        <div style={{fontSize:'2.6rem',marginBottom:6}}>{w.e}</div>
        <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.1rem',color:'#4d96ff'}}>{w.en}</div>
        <div style={{fontSize:'0.74rem',color:dark?'#c9b8ff':'#6b5b95',marginTop:2}}>{w.ar}</div>
        <div style={{marginTop:5,fontSize:'0.7rem',color:'#4d96ff',fontWeight:700}}>ğŸ”Š Ø§Ø¶ØºØ·!</div>
      </div>
    );
  }

  function PhraseCard({p, dark}) {
    const [on,setOn]=useState(false);
    return (
      <div onClick={()=>{setOn(true);speak(p.en);setTimeout(()=>setOn(false),1200);}}
        style={{
          background:on?'#e8f5e9':(dark?'#1a1430':'#fff'),
          border:`2px solid ${on?'#6bcb77':'#e8d5ff'}`,
          borderRadius:16,padding:'12px 14px',cursor:'pointer',
          display:'flex',alignItems:'center',gap:10,
          transition:'all .2s',boxShadow:'0 4px 12px rgba(0,0,0,.07)',
        }}>
        <span style={{fontSize:'2rem'}}>{p.e}</span>
        <div>
          <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1rem',color:'#4d96ff'}}>{p.en}</div>
          <div style={{fontSize:'0.8rem',color:dark?'#c9b8ff':'#6b5b95'}}>{p.ar}</div>
        </div>
        <span style={{marginLeft:'auto',fontSize:'1.1rem',opacity:.6}}>ğŸ”Š</span>
      </div>
    );
  }

  function CartoonHero() {
    return (
      <svg viewBox="0 0 520 220" style={{width:'100%',maxWidth:520,display:'block',margin:'0 auto'}}>
        <rect width="520" height="220" fill="#e3f2fd" rx="20"/>
        <circle cx="60" cy="40" r="28" fill="white" opacity=".7"/>
        <circle cx="90" cy="32" r="20" fill="white" opacity=".7"/>
        <circle cx="440" cy="35" r="24" fill="white" opacity=".6"/>
        <circle cx="465" cy="28" r="18" fill="white" opacity=".6"/>
        <ellipse cx="260" cy="210" rx="220" ry="22" fill="#a5d6a7"/>
        <rect x="40" y="190" width="440" height="30" fill="#81c784" rx="8"/>
        <text x="55" y="195" fontSize="16">ğŸŒ¸</text>
        <text x="430" y="195" fontSize="16">ğŸŒº</text>
        <text x="240" y="195" fontSize="14">ğŸŒ¼</text>
        {/* BOY */}
        <ellipse cx="155" cy="207" rx="40" ry="7" fill="#90a4ae" opacity=".3"/>
        <ellipse cx="135" cy="200" rx="18" ry="8" fill="#3e2723"/>
        <ellipse cx="175" cy="200" rx="18" ry="8" fill="#3e2723"/>
        <rect x="125" y="155" width="28" height="50" rx="10" fill="#1565c0"/>
        <rect x="160" y="155" width="28" height="50" rx="10" fill="#1976d2"/>
        <rect x="115" y="90" width="90" height="72" rx="16" fill="#e53935"/>
        <rect x="147" y="90" width="26" height="72" rx="6" fill="#ef9a9a" opacity=".6"/>
        <rect x="85" y="95" width="32" height="55" rx="14" fill="#ffcc80"/>
        <rect x="203" y="95" width="32" height="55" rx="14" fill="#ffcc80"/>
        <ellipse cx="101" cy="150" rx="14" ry="11" fill="#ffb74d"/>
        <rect x="90" y="139" width="8" height="14" rx="4" fill="#ffb74d"/>
        <rect x="100" y="137" width="8" height="16" rx="4" fill="#ffb74d"/>
        <rect x="110" y="139" width="8" height="14" rx="4" fill="#ffb74d"/>
        <ellipse cx="219" cy="147" rx="14" ry="11" fill="#ffb74d"/>
        <rect x="148" y="66" width="24" height="30" rx="8" fill="#ffcc80"/>
        <ellipse cx="160" cy="50" rx="46" ry="48" fill="#ffcc80"/>
        <ellipse cx="160" cy="12" rx="46" ry="24" fill="#3e2723"/>
        <rect x="114" y="12" width="92" height="26" fill="#3e2723"/>
        <ellipse cx="114" cy="35" rx="12" ry="18" fill="#3e2723"/>
        <ellipse cx="206" cy="33" rx="11" ry="16" fill="#3e2723"/>
        <ellipse cx="114" cy="52" rx="11" ry="13" fill="#ffcc80"/>
        <ellipse cx="206" cy="52" rx="11" ry="13" fill="#ffcc80"/>
        <ellipse cx="145" cy="46" rx="10" ry="11" fill="white"/>
        <ellipse cx="175" cy="46" rx="10" ry="11" fill="white"/>
        <ellipse cx="147" cy="48" rx="6" ry="7" fill="#1a237e"/>
        <ellipse cx="177" cy="48" rx="6" ry="7" fill="#1a237e"/>
        <circle cx="149" cy="45" r="2" fill="white"/>
        <circle cx="179" cy="45" r="2" fill="white"/>
        <path d="M136,37 Q145,32 154,36" stroke="#3e2723" strokeWidth="2.5" fill="none" strokeLinecap="round"/>
        <path d="M166,36 Q175,31 184,35" stroke="#3e2723" strokeWidth="2.5" fill="none" strokeLinecap="round"/>
        <path d="M143,64 Q160,78 177,64" stroke="#e65100" strokeWidth="3" fill="none" strokeLinecap="round"/>
        <rect x="150" y="64" width="20" height="8" rx="4" fill="white"/>
        <ellipse cx="132" cy="58" rx="11" ry="7" fill="#ff8a65" opacity=".4"/>
        <ellipse cx="188" cy="58" rx="11" ry="7" fill="#ff8a65" opacity=".4"/>
        <rect x="203" y="94" width="30" height="68" rx="10" fill="#388e3c"/>
        <rect x="209" y="108" width="20" height="24" rx="6" fill="#4caf50"/>
        <text x="219" y="123" fontSize="8" fill="white" textAnchor="middle" fontWeight="800">ABC</text>
        <rect x="218" y="18" width="120" height="52" rx="14" fill="white" stroke="#4d96ff" strokeWidth="2.5"/>
        <polygon points="230,70 218,88 250,70" fill="white"/>
        <polygon points="230,70 218,88 250,70" fill="none" stroke="#4d96ff" strokeWidth="2.5" strokeLinejoin="round"/>
        <polygon points="231,69 221,83 248,69" fill="white"/>
        <text x="278" y="43" fontSize="13" fontWeight="900" fill="#4d96ff" textAnchor="middle" fontFamily="Arial Rounded MT Bold,Arial,sans-serif">Hello! ğŸ‘‹</text>
        <text x="278" y="61" fontSize="10" fill="#90a4ae" textAnchor="middle">Ù…Ø±Ø­Ø¨Ø§Ù‹!</text>
        {/* GIRL */}
        <ellipse cx="365" cy="207" rx="40" ry="7" fill="#90a4ae" opacity=".3"/>
        <ellipse cx="345" cy="200" rx="18" ry="8" fill="#880e4f"/>
        <ellipse cx="385" cy="200" rx="18" ry="8" fill="#880e4f"/>
        <path d="M330,158 Q325,205 345,205 L385,205 Q405,205 400,158 Z" fill="#7b1fa2"/>
        <rect x="325" y="90" width="90" height="74" rx="16" fill="#9c27b0"/>
        <text x="370" y="140" fontSize="20" textAnchor="middle">â­</text>
        <rect x="294" y="95" width="33" height="56" rx="14" fill="#ffcc80"/>
        <rect x="413" y="95" width="33" height="56" rx="14" fill="#ffcc80"/>
        <ellipse cx="310" cy="150" rx="14" ry="11" fill="#ffb74d"/>
        <rect x="299" y="139" width="8" height="14" rx="4" fill="#ffb74d"/>
        <rect x="309" y="137" width="8" height="16" rx="4" fill="#ffb74d"/>
        <rect x="319" y="139" width="8" height="14" rx="4" fill="#ffb74d"/>
        <ellipse cx="429" cy="148" rx="14" ry="11" fill="#ffb74d"/>
        <rect x="424" y="136" width="36" height="28" rx="5" fill="#ff5722"/>
        <text x="442" y="152" fontSize="7" fill="white" textAnchor="middle" fontWeight="800">English</text>
        <rect x="358" y="66" width="24" height="30" rx="8" fill="#ffcc80"/>
        <ellipse cx="370" cy="50" rx="46" ry="48" fill="#ffcc80"/>
        <ellipse cx="370" cy="10" rx="47" ry="24" fill="#212121"/>
        <rect x="323" y="10" width="94" height="32" fill="#212121"/>
        <rect x="323" y="28" width="20" height="100" rx="10" fill="#212121"/>
        <rect x="397" y="28" width="20" height="100" rx="10" fill="#212121"/>
        <ellipse cx="404" cy="16" rx="14" ry="9" fill="#ff4081" transform="rotate(-25,404,16)"/>
        <ellipse cx="418" cy="14" rx="14" ry="9" fill="#ff4081" transform="rotate(25,418,14)"/>
        <circle cx="411" cy="15" r="6" fill="#ff80ab"/>
        <ellipse cx="324" cy="52" rx="11" ry="13" fill="#ffcc80"/>
        <ellipse cx="416" cy="52" rx="11" ry="13" fill="#ffcc80"/>
        <circle cx="324" cy="60" r="4" fill="#ffd93d"/>
        <circle cx="416" cy="60" r="4" fill="#ffd93d"/>
        <ellipse cx="355" cy="46" rx="10" ry="11" fill="white"/>
        <ellipse cx="385" cy="46" rx="10" ry="11" fill="white"/>
        <ellipse cx="357" cy="48" rx="7" ry="8" fill="#1a237e"/>
        <ellipse cx="387" cy="48" rx="7" ry="8" fill="#1a237e"/>
        <circle cx="359" cy="45" r="2.5" fill="white"/>
        <circle cx="389" cy="45" r="2.5" fill="white"/>
        <path d="M345,36 Q355,30 365,35" stroke="#212121" strokeWidth="2.5" fill="none" strokeLinecap="round"/>
        <path d="M375,35 Q385,29 395,34" stroke="#212121" strokeWidth="2.5" fill="none" strokeLinecap="round"/>
        <ellipse cx="370" cy="57" rx="6" ry="5" fill="#ffb74d"/>
        <path d="M352,68 Q370,84 388,68" stroke="#e65100" strokeWidth="3" fill="none" strokeLinecap="round"/>
        <rect x="359" y="68" width="22" height="8" rx="4" fill="white"/>
        <ellipse cx="338" cy="60" rx="12" ry="7" fill="#ff8a65" opacity=".4"/>
        <ellipse cx="402" cy="60" rx="12" ry="7" fill="#ff8a65" opacity=".4"/>
        <rect x="162" y="18" width="148" height="66" rx="14" fill="white" stroke="#ff6b6b" strokeWidth="2.5"/>
        <polygon points="310,60 330,85 290,60" fill="white"/>
        <polygon points="310,60 330,85 290,60" fill="none" stroke="#ff6b6b" strokeWidth="2.5" strokeLinejoin="round"/>
        <polygon points="309,59 326,80 293,59" fill="white"/>
        <text x="236" y="42" fontSize="12" fontWeight="900" fill="#ff6b6b" textAnchor="middle" fontFamily="Arial Rounded MT Bold,Arial,sans-serif">How are you? ğŸ˜Š</text>
        <text x="236" y="58" fontSize="10" fill="#90a4ae" textAnchor="middle">ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ</text>
        <rect x="175" y="62" width="128" height="16" rx="6" fill="#fff3e0"/>
        <text x="239" y="74" fontSize="9" fontWeight="800" fill="#e65100" textAnchor="middle">I'm fine, thank you! ğŸŒŸ</text>
      </svg>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  KEY MODAL COMPONENT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function KeyModal({ apiKey, setApiKey, setShowKeyModal }) {
    const [val, setVal] = useState(apiKey || '');
    const [err, setErr] = useState('');
    const [testing, setTesting] = useState(false);

    const save = async () => {
      const k = val.trim();
      if (!k) { setErr('âŒ Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø£ÙˆÙ„Ø§Ù‹!'); return; }
      if (!k.startsWith('sk-ant-')) { setErr('âŒ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ø§Ø²Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ù€ sk-ant-'); return; }
      setTesting(true); setErr('');
      // quick test call
      try {
        const r = await fetch('https://api.anthropic.com/v1/messages', {
          method:'POST',
          headers:{'Content-Type':'application/json','x-api-key':k,'anthropic-version':'2023-06-01','anthropic-dangerous-allow-browser':'true'},
          body: JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:10,messages:[{role:'user',content:'Hi'}]}),
        });
        const d = await r.json();
        if (d.error) { setErr('âŒ Ù…ÙØªØ§Ø­ ØºÙ„Ø·: ' + d.error.message); setTesting(false); return; }
        // success!
        localStorage.setItem('ek_api_key', k);
        setApiKey(k);
        setShowKeyModal(false);
      } catch(e) {
        setErr('âŒ ' + e.message);
      }
      setTesting(false);
    };

    const clear = () => {
      localStorage.removeItem('ek_api_key');
      setApiKey('');
      setVal('');
      setShowKeyModal(false);
    };

    return (
      <div style={{
        position:'fixed', inset:0, background:'rgba(0,0,0,.6)',
        display:'flex', alignItems:'center', justifyContent:'center',
        zIndex:9999, padding:16, backdropFilter:'blur(4px)',
      }}>
        <div style={{
          background:'#fff', borderRadius:24, padding:'28px 24px',
          width:'100%', maxWidth:440, boxShadow:'0 20px 60px rgba(0,0,0,.3)',
          animation:'pop .3s ease',
        }}>
          {/* Header */}
          <div style={{textAlign:'center',marginBottom:20}}>
            <div style={{fontSize:'3rem',marginBottom:8}}>ğŸ”‘</div>
            <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.5rem',color:'#2d1b69'}}>
              Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            </div>
            <div style={{fontSize:'0.83rem',color:'#6b5b95',fontWeight:600,marginTop:4}}>
              Ø¹Ø´Ø§Ù† Ø±ÙˆØ¨ÙŠ ÙˆØ§Ù„Ù‚ØµØµ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªØ´ØªØºÙ„
            </div>
          </div>

          {/* How to get key */}
          <div style={{background:'#e3f2fd',borderRadius:14,padding:'12px 14px',marginBottom:16}}>
            <div style={{fontWeight:800,color:'#1565c0',fontSize:'0.85rem',marginBottom:6}}>ğŸ“‹ Ø¥Ø²Ø§ÙŠ ØªØ¬ÙŠØ¨ Ø§Ù„Ù…ÙØªØ§Ø­ØŸ</div>
            <div style={{fontSize:'0.8rem',color:'#1565c0',fontWeight:600,lineHeight:1.7}}>
              1ï¸âƒ£ Ø±ÙˆØ­ Ø¹Ù„Ù‰ <b>console.anthropic.com</b><br/>
              2ï¸âƒ£ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ø¹Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ø¬Ø§Ù†Ø§Ù‹<br/>
              3ï¸âƒ£ Ø§Ø¶ØºØ· <b>API Keys â†’ Create Key</b><br/>
              4ï¸âƒ£ Ø§Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ (Ø¨ÙŠØ¨Ø¯Ø£ Ø¨Ù€ sk-ant-...)
            </div>
          </div>

          {/* Input */}
          <div style={{marginBottom:12}}>
            <label style={{display:'block',fontWeight:800,color:'#2d1b69',marginBottom:6,fontSize:'0.85rem'}}>
              ğŸ” Ø§Ù„ØµÙ‚ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§:
            </label>
            <input
              type="password"
              value={val}
              onChange={e=>setVal(e.target.value)}
              onKeyPress={e=>e.key==='Enter'&&save()}
              placeholder="sk-ant-api03-..."
              dir="ltr"
              style={{
                width:'100%', padding:'12px 16px', borderRadius:12,
                border:'2px solid #e8d5ff', outline:'none',
                fontFamily:'monospace', fontSize:'0.88rem',
                background:'#f3eeff', color:'#2d1b69',
              }}
            />
          </div>

          {err && (
            <div style={{background:'#ffebee',border:'2px solid #ef9a9a',borderRadius:10,padding:'8px 12px',marginBottom:12,fontSize:'0.82rem',fontWeight:700,color:'#c62828'}}>
              {err}
            </div>
          )}

          {/* Security note */}
          <div style={{background:'#f3e5f5',borderRadius:10,padding:'8px 12px',marginBottom:16,fontSize:'0.76rem',color:'#6a1b9a',fontWeight:600}}>
            ğŸ”’ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨ÙŠØªØ­ÙØ¸ ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø· â€” Ù…Ø´ Ø¨ÙŠØ±ÙˆØ­ Ù„Ø£ÙŠ Ø³ÙŠØ±ÙØ± ØªØ§Ù†ÙŠ
          </div>

          {/* Buttons */}
          <div style={{display:'flex',gap:10,flexWrap:'wrap'}}>
            <button onClick={save} disabled={testing} style={{
              flex:1, padding:'12px', borderRadius:50, border:'none',
              background:'linear-gradient(135deg,#4d96ff,#845ef7)',
              color:'#fff', fontWeight:800, cursor:'pointer',
              fontFamily:"'Nunito',sans-serif", fontSize:'0.95rem',
              boxShadow:'0 4px 14px rgba(77,150,255,.4)',
              opacity: testing ? .6 : 1,
            }}>
              {testing ? 'â³ Ø¨ÙŠØªØ­Ù‚Ù‚...' : 'âœ… Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„!'}
            </button>
            <button onClick={()=>setShowKeyModal(false)} style={{
              padding:'12px 18px', borderRadius:50, border:'2px solid #e8d5ff',
              background:'#f3eeff', color:'#6b5b95', fontWeight:800,
              cursor:'pointer', fontFamily:"'Nunito',sans-serif", fontSize:'0.88rem',
            }}>
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>

          {apiKey && (
            <button onClick={clear} style={{
              display:'block', width:'100%', marginTop:10,
              padding:'8px', borderRadius:50, border:'none',
              background:'#ffebee', color:'#c62828', fontWeight:700,
              cursor:'pointer', fontFamily:"'Nunito',sans-serif", fontSize:'0.82rem',
            }}>
              ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…ÙØªØ§Ø­
            </button>
          )}
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  MAIN APP
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function App() {
    const [dark,   setDark]   = useState(false);
    const [tab,    setTab]    = useState('home');
    const [score,  setScore]  = useState(0);
    const [streak, setStreak] = useState(0);

    // words
    const [cat,       setCat]       = useState('animals');
    const [extra,     setExtra]     = useState([]);
    const [aiTopic,   setAiTopic]   = useState('');
    const [aiLoading, setAiLoading] = useState(false);
    const [aiErr,     setAiErr]     = useState('');
    const [apiKey,    setApiKey]    = useState(localStorage.getItem('ek_api_key') || '');
    const [showKeyModal, setShowKeyModal] = useState(!localStorage.getItem('ek_api_key'));
    const noKey = !apiKey;

    // chat
    const [msgs,    setMsgs]   = useState([{role:'ai',text:'Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‰ Ø£Ù†Ø§ Ø±ÙˆØ¨ÙŠ!\nØ§ÙƒØªØ¨ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙˆØ£Ù†Ø§ Ù‡Ø³Ø§Ø¹Ø¯Ùƒ ğŸ˜„\nØ¬Ø±Ø¨: "Hello Roby!" ğŸ‘‹'}]);
    const [inp,     setInp]    = useState('');
    const [chatBusy,setChatBusy] = useState(false);
    const histRef = useRef([]);
    const chatRef = useRef(null);

    // story
    const [sType, setSType] = useState('adventure');
    const [story, setStory] = useState('');
    const [sLoad, setSLoad] = useState(false);

    // quiz
    const [qState, setQState] = useState('start');
    const [qWords, setQWords] = useState([]);
    const [qIdx,   setQIdx]   = useState(0);
    const [qScore, setQScore] = useState(0);
    const [picked, setPicked] = useState(null);
    const [qOpts,  setQOpts]  = useState([]);

    const addScore = n => { setScore(s=>s+n); setStreak(k=>k+1); };
    const d = dark;

    useEffect(()=>{
      if(chatRef.current) chatRef.current.scrollTop=chatRef.current.scrollHeight;
    },[msgs,chatBusy]);

    const currentWords = [...(WORDS[cat]||[]), ...extra.filter(w=>w._cat===cat)];

    const genOpts = useCallback((w)=>{
      const all = Object.values(WORDS).flat();
      const wrong = all.filter(x=>x.en!==w.en).sort(()=>Math.random()-.5).slice(0,3);
      return [...wrong,w].sort(()=>Math.random()-.5);
    },[]);

    // â”€â”€ AI words â”€â”€
    const genWords = async () => {
      if(!aiTopic.trim() || noKey) return;
      setAiLoading(true); setAiErr('');
      try {
        const res = await callAI(
          'Return ONLY a raw JSON array â€” no markdown, no backticks.',
          `Generate 6 simple English words about "${aiTopic}" for Egyptian kids aged 7-9.
Format: [{"en":"Word","ar":"Ø§Ù„ØªØ±Ø¬Ù…Ø©","e":"emoji"}]`
        );
        const parsed = JSON.parse(res.replace(/\`\`\`json|\`\`\`/g,'').trim());
        setExtra(prev=>[...prev.filter(w=>w._cat!==cat),...parsed.map(w=>({...w,_cat:cat}))]);
        addScore(3);
      } catch(e) { setAiErr('âŒ '+e.message); }
      setAiLoading(false);
    };

    // â”€â”€ chat â”€â”€
    const sendMsg = async () => {
      const m = inp.trim();
      if(!m || chatBusy) return;
      if(noKey){ setShowKeyModal(true); return; }
      setInp('');
      setMsgs(prev=>[...prev,{role:'user',text:m}]);
      histRef.current.push({role:'user',content:m});
      setChatBusy(true);
      try {
        const res = await callAI(
          `You are Roby (Ø±ÙˆØ¨ÙŠ), a fun English teacher for Egyptian kids aged 7-9.
Mix simple English + Arabic. Use emojis. Max 4 sentences. Praise English writing. Correct gently.`,
          histRef.current
        );
        histRef.current.push({role:'assistant',content:res});
        setMsgs(prev=>[...prev,{role:'ai',text:res}]);
        addScore(2);
      } catch(e) { setMsgs(prev=>[...prev,{role:'ai',text:'âŒ '+e.message}]); }
      setChatBusy(false);
    };

    // â”€â”€ story â”€â”€
    const genStory = async () => {
      if(noKey){ setShowKeyModal(true); return; }
      setSLoad(true); setStory('');
      try {
        const res = await callAI(
          'You write short fun English stories for Egyptian kids aged 7-9.',
          `Write a fun story (max 110 words) about: ${STORY_TOPICS[sType].en}
Simple A1 vocab. 2 cartoon characters with names. 6 emojis. End with ONE question.
First line: TITLE IN CAPS. Reply with story text only.`
        );
        setStory(res); addScore(5);
      } catch(e) { setStory('âŒ '+e.message); }
      setSLoad(false);
    };

    // â”€â”€ quiz â”€â”€
    const startQuiz = () => {
      const all = Object.values(WORDS).flat().sort(()=>Math.random()-.5).slice(0,10);
      setQWords(all); setQIdx(0); setQScore(0); setPicked(null);
      setQOpts(genOpts(all[0])); setQState('playing');
    };

    const pickAnswer = (opt) => {
      if(picked) return;
      const w = qWords[qIdx];
      const correct = opt.en===w.en;
      setPicked(opt.en);
      if(correct){ setQScore(s=>s+1); speak(w.en); }
      setTimeout(()=>{
        const next = qIdx+1;
        if(next>=qWords.length){ setQState('done'); addScore(qScore*2+(correct?2:0)); }
        else { setQIdx(next); setQOpts(genOpts(qWords[next])); setPicked(null); }
      },1800);
    };

    const TABS = [
      ['home','ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'],['words','ğŸ“š ÙƒÙ„Ù…Ø§Øª'],['phrases','ğŸ’¬ Ø¬Ù…Ù„'],
      ['chat','ğŸ¤– Ø±ÙˆØ¨ÙŠ'],['story','ğŸ“– Ù‚ØµØµ'],['quiz','ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø±'],
    ];

    return (
      <>
        <div style={S.app(d)}>

          {/* HEADER */}
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:16,flexWrap:'wrap',gap:8}}>
            <div>
              <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.8rem',lineHeight:1,
                background:'linear-gradient(135deg,#ff6b6b,#4d96ff)',WebkitBackgroundClip:'text',
                WebkitTextFillColor:'transparent',backgroundClip:'text'}}>ğŸ“ Super English Kids!</div>
              <div style={{fontSize:'0.75rem',color:d?'#c9b8ff':'#6b5b95',fontWeight:700,marginTop:2}}>Ù„Ù„Ø£Ø·ÙØ§Ù„ Ù…Ù† 7-9 Ø³Ù†ÙˆØ§Øª âœ¨</div>
            </div>
            <div style={{display:'flex',gap:8,alignItems:'center',flexWrap:'wrap'}}>
              <div style={S.pill('#ffe0f0','#c2185b')}>â­ {score} Ù†Ø¬Ù…Ø©</div>
              {streak>2 && <div style={S.pill('#fff3e0','#e65100')}>ğŸ”¥ {streak}</div>}
              <button className="tbtn" onClick={()=>setDark(x=>!x)}
                style={{...S.btn(d?'#2d2050':'#e8d5ff'),color:d?'#f0e6ff':'#2d1b69'}}>
                {d?'â˜€ï¸':'ğŸŒ™'}
              </button>
            </div>
          </div>

          {/* API KEY BANNER */}
          {noKey && (
            <div onClick={()=>setShowKeyModal(true)} style={{
              background:'linear-gradient(135deg,#fff3e0,#fce4ec)',
              border:'2px solid #ffd93d',borderRadius:14,padding:'12px 16px',marginBottom:14,
              cursor:'pointer',display:'flex',alignItems:'center',gap:10,flexWrap:'wrap',
            }}>
              <span style={{fontSize:'1.5rem'}}>ğŸ”‘</span>
              <div style={{flex:1}}>
                <div style={{fontWeight:800,fontSize:'0.88rem',color:'#e65100'}}>ÙØ¹Ù‘Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!</div>
                <div style={{fontSize:'0.76rem',color:'#bf360c',fontWeight:600}}>Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† ØªØ¶Ø¹ API key ÙˆØªÙØ¹Ù‘Ù„ Ø±ÙˆØ¨ÙŠ ÙˆØ§Ù„Ù‚ØµØµ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
              </div>
              <div style={{background:'#ff6b6b',color:'white',borderRadius:50,padding:'6px 16px',fontWeight:800,fontSize:'0.82rem'}}>
                Ø¶Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ ğŸ”‘
              </div>
            </div>
          )}
          {apiKey && (
            <div style={{
              background:'linear-gradient(135deg,#e8f5e9,#e3f2fd)',
              border:'2px solid #81c784',borderRadius:14,padding:'10px 16px',marginBottom:14,
              display:'flex',alignItems:'center',gap:10,justifyContent:'space-between',flexWrap:'wrap',
            }}>
              <div style={{display:'flex',alignItems:'center',gap:8}}>
                <span style={{fontSize:'1.2rem'}}>âœ…</span>
                <span style={{fontWeight:800,fontSize:'0.85rem',color:'#2e7d32'}}>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø´ØºØ§Ù„! Ø±ÙˆØ¨ÙŠ Ø¬Ø§Ù‡Ø² ğŸ¤–</span>
              </div>
              <button onClick={()=>setShowKeyModal(true)} style={{
                background:'none',border:'2px solid #81c784',borderRadius:50,padding:'4px 12px',
                fontSize:'0.75rem',fontWeight:700,color:'#2e7d32',cursor:'pointer',
              }}>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙØªØ§Ø­</button>
            </div>
          )}
          {/* KEY MODAL */}
          {showKeyModal && <KeyModal apiKey={apiKey} setApiKey={setApiKey} setShowKeyModal={setShowKeyModal}/>}

          {/* TABS */}
          <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:16}}>
            {TABS.map(([id,label])=>(
              <button key={id} className="tbtn" style={S.tab(tab===id,d)} onClick={()=>setTab(id)}>{label}</button>
            ))}
          </div>

          {/* â”€â”€ HOME â”€â”€ */}
          {tab==='home' && (
            <>
              <div style={S.card(d)}><CartoonHero/></div>
              <div style={S.card(d)}>
                <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.2rem',color:'#ff6b6b',marginBottom:12,textAlign:'center'}}>
                  ğŸš€ Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ!
                </div>
                <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(130px,1fr))',gap:10}}>
                  {[['ğŸ“š','ÙƒÙ„Ù…Ø§Øª','words','#e3f2fd','#1565c0'],
                    ['ğŸ’¬','Ø¬Ù…Ù„','phrases','#fce4ec','#880e4f'],
                    ['ğŸ¤–','Ø±ÙˆØ¨ÙŠ','chat','#e8f5e9','#2e7d32'],
                    ['ğŸ“–','Ù‚ØµØµ','story','#fff3e0','#e65100'],
                    ['ğŸ¯','Ø§Ø®ØªØ¨Ø§Ø±','quiz','#f3e5f5','#6a1b9a']].map(([ic,lab,tid,bg,col])=>(
                    <div key={tid} onClick={()=>setTab(tid)} className="wcard"
                      style={{background:bg,borderRadius:16,padding:'18px 10px',textAlign:'center',cursor:'pointer',border:`2px solid ${col}22`}}>
                      <div style={{fontSize:'2rem',marginBottom:6}}>{ic}</div>
                      <div style={{fontWeight:800,color:col,fontSize:'0.88rem'}}>{lab}</div>
                    </div>
                  ))}
                </div>
              </div>
              <div style={S.card(d)}>
                <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1rem',color:'#4d96ff',marginBottom:8}}>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</div>
                <div style={{display:'flex',gap:10,flexWrap:'wrap'}}>
                  <span style={S.pill('#e3f2fd','#1565c0')}>â­ {score} Ù†Ø¬Ù…Ø©</span>
                  <span style={S.pill('#e8f5e9','#2e7d32')}>ğŸ”¥ {streak} ØªØªØ§Ø¨Ø¹</span>
                  <span style={S.pill('#fff3e0','#e65100')}>ğŸ“š {Object.values(WORDS).flat().length} ÙƒÙ„Ù…Ø©</span>
                </div>
              </div>
            </>
          )}

          {/* â”€â”€ WORDS â”€â”€ */}
          {tab==='words' && (
            <>
              <div style={S.card(d)}>
                <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1rem',color:'#4d96ff',marginBottom:10}}>Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ğŸ¨</div>
                <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:14}}>
                  {Object.keys(CAT_NAMES).map(k=>(
                    <button key={k} className="tbtn" style={S.cat(cat===k)} onClick={()=>{setCat(k);setExtra([]);}}>{CAT_NAMES[k]}</button>
                  ))}
                </div>
                {!noKey && (
                  <div style={{borderTop:`1px solid ${d?'#2d2050':'#f3eeff'}`,paddingTop:12}}>
                    <div style={{fontWeight:700,color:d?'#c9b8ff':'#6b5b95',marginBottom:8,fontSize:'0.83rem'}}>ğŸ¤– Ø§Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</div>
                    <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                      <input style={{...S.inp(d),maxWidth:210}} dir="ltr" placeholder="e.g. sports, weather..."
                        value={aiTopic} onChange={e=>setAiTopic(e.target.value)} onKeyPress={e=>e.key==='Enter'&&genWords()}/>
                      <button className="tbtn" style={S.btn('linear-gradient(135deg,#ff6b6b,#ffd93d)','0 4px 14px rgba(255,107,107,.4)')}
                        onClick={genWords} disabled={aiLoading||!aiTopic.trim()}>
                        {aiLoading?'â³...':'âœ¨ Ø§Ø¬ÙŠØ¨!'}
                      </button>
                    </div>
                    {aiErr && <div style={{color:'#ff6b6b',fontSize:'0.8rem',marginTop:6}}>{aiErr}</div>}
                  </div>
                )}
              </div>
              <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(126px,1fr))',gap:12,marginBottom:14}}>
                {currentWords.map((w,i)=>(
                  <WordCard key={i} w={w} dark={d} onSpeak={t=>{speak(t);addScore(1);}}/>
                ))}
              </div>
            </>
          )}

          {/* â”€â”€ PHRASES â”€â”€ */}
          {tab==='phrases' && (
            <>
              <div style={S.card(d)}>
                <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.1rem',color:'#ff6b6b',marginBottom:4}}>ğŸ’¬ Ø¬Ù…Ù„ ÙŠÙˆÙ…ÙŠØ©!</div>
                <div style={{fontSize:'0.82rem',color:d?'#c9b8ff':'#6b5b95',fontWeight:700}}>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¬Ù…Ù„Ø© Ø¹Ø´Ø§Ù† ØªØ³Ù…Ø¹Ù‡Ø§ ğŸ”Š</div>
              </div>
              <div style={{display:'flex',flexDirection:'column',gap:10}}>
                {PHRASES.map((p,i)=><PhraseCard key={i} p={p} dark={d}/>)}
              </div>
            </>
          )}

          {/* â”€â”€ CHAT â”€â”€ */}
          {tab==='chat' && (
            <>
              <div style={{...S.card(d),background:'linear-gradient(135deg,#fff0f6,#f0f0ff)',padding:'12px 16px',marginBottom:12}}>
                <div style={{fontWeight:800,fontSize:'0.88rem'}}>ğŸ¤– Ø£Ù†Ø§ <b>Ø±ÙˆØ¨ÙŠ</b>! Ø§ØªÙƒÙ„Ù… Ù…Ø¹Ø§ÙŠØ§ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ğŸ˜„</div>
              </div>
              <div ref={chatRef} style={{
                background:d?'#1e1638':'#f3eeff',borderRadius:18,padding:14,
                height:320,overflowY:'auto',marginBottom:12,
                display:'flex',flexDirection:'column',gap:10,
                border:`2px solid ${d?'#2d2050':'#e8d5ff'}`,
              }}>
                {msgs.map((m,i)=>(
                  <div key={i} style={{display:'flex',gap:8,flexDirection:m.role==='user'?'row-reverse':'row',alignItems:'flex-end',animation:'fadeUp .3s ease'}}>
                    <div style={{fontSize:'1.6rem',flexShrink:0}}>{m.role==='user'?'ğŸ‘¦':'ğŸ¤–'}</div>
                    <div>
                      <div style={{
                        borderRadius:16,padding:'10px 14px',maxWidth:'78%',fontSize:'0.9rem',
                        fontWeight:600,lineHeight:1.6,whiteSpace:'pre-wrap',wordBreak:'break-word',
                        background:m.role==='user'?'#4d96ff':(d?'#1a1430':'#fff'),
                        color:m.role==='user'?'#fff':(d?'#f0e6ff':'#2d1b69'),
                        border:`2px solid ${m.role==='user'?'#4d96ff':(d?'#2d2050':'#e8d5ff')}`,
                      }}>{m.text}</div>
                      {m.role==='ai' && (
                        <button onClick={()=>speak(m.text)} style={{background:'none',border:'none',cursor:'pointer',fontSize:'0.95rem',opacity:.6,marginTop:2}}>ğŸ”Š</button>
                      )}
                    </div>
                  </div>
                ))}
                {chatBusy && (
                  <div style={{display:'flex',gap:8,alignItems:'flex-end'}}>
                    <div style={{fontSize:'1.6rem'}}>ğŸ¤–</div>
                    <div style={{background:d?'#1a1430':'#fff',border:`2px solid ${d?'#2d2050':'#e8d5ff'}`,borderRadius:16,padding:'12px 16px'}}>
                      <Dots/>
                    </div>
                  </div>
                )}
              </div>
              <div style={{display:'flex',gap:8}}>
                <input style={S.inp(d)} dir="ltr" placeholder="Ø§ÙƒØªØ¨ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠ..."
                  value={inp} onChange={e=>setInp(e.target.value)} onKeyPress={e=>e.key==='Enter'&&sendMsg()}/>
                <button className="tbtn" style={S.btn('linear-gradient(135deg,#4d96ff,#845ef7)','0 4px 14px rgba(77,150,255,.4)')}
                  onClick={sendMsg} disabled={chatBusy||!inp.trim()}>Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
              </div>
            </>
          )}

          {/* â”€â”€ STORY â”€â”€ */}
          {tab==='story' && (
            <>
              <div style={S.card(d)}>
                <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1rem',color:'#ff6b6b',marginBottom:10}}>ğŸ“– Ø§Ø®ØªØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©:</div>
                <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:14}}>
                  {Object.entries(STORY_TOPICS).map(([k,v])=>(
                    <button key={k} className="tbtn" style={S.cat(sType===k)} onClick={()=>setSType(k)}>{v.label}</button>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                  <button className="tbtn" style={S.btn('linear-gradient(135deg,#ff6b6b,#ffd93d)','0 4px 14px rgba(255,107,107,.4)')}
                    onClick={genStory} disabled={sLoad}>{sLoad?'â³ Ø¨ÙŠÙƒØªØ¨...':'ğŸ“– Ø§Ø­ÙƒÙŠÙ„ÙŠ Ù‚ØµØ©!'}</button>
                  <button className="tbtn" style={S.btn('linear-gradient(135deg,#6bcb77,#4d96ff)','0 4px 14px rgba(107,203,119,.4)')}
                    onClick={()=>story&&speak(story)} disabled={!story||sLoad}>ğŸ”Š Ø§Ø³Ù…Ø¹ Ø§Ù„Ù‚ØµØ©</button>
                </div>
              </div>
              <div style={{...S.card(d),minHeight:180}}>
                {sLoad && <div style={{textAlign:'center',padding:'30px'}}><Dots/></div>}
                {!sLoad && !story && (
                  <div style={{textAlign:'center',padding:'30px',color:d?'#c9b8ff':'#6b5b95'}}>
                    <div style={{fontSize:'3rem',marginBottom:10}}>ğŸ“š</div>
                    <div style={{fontWeight:700}}>Ø§Ø¶ØºØ· "Ø§Ø­ÙƒÙŠÙ„ÙŠ Ù‚ØµØ©" ğŸ‰</div>
                  </div>
                )}
                {!sLoad && story && <div style={{lineHeight:1.9,fontSize:'0.97rem',fontWeight:600,whiteSpace:'pre-wrap'}}>{story}</div>}
              </div>
            </>
          )}

          {/* â”€â”€ QUIZ â”€â”€ */}
          {tab==='quiz' && (
            <div style={{...S.card(d),textAlign:'center',padding:'28px 16px'}}>
              {qState==='start' && (
                <>
                  <div style={{fontSize:'4rem',marginBottom:14}}>ğŸ¯</div>
                  <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.5rem',marginBottom:8}}>Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ</div>
                  <div style={{color:d?'#c9b8ff':'#6b5b95',fontWeight:700,marginBottom:24}}>10 Ø£Ø³Ø¦Ù„Ø© â€” Ø§ÙƒØ³Ø¨ Ù†Ø¬ÙˆÙ… â­</div>
                  <button className="tbtn" style={S.btn('linear-gradient(135deg,#4d96ff,#845ef7)','0 4px 14px rgba(77,150,255,.4)')}
                    onClick={startQuiz}>ğŸš€ Ø§Ø¨Ø¯Ø£!</button>
                </>
              )}
              {qState==='playing' && qWords[qIdx] && (()=>{
                const w = qWords[qIdx];
                return (
                  <>
                    <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:16,justifyContent:'center'}}>
                      <span style={{fontWeight:800,color:d?'#c9b8ff':'#6b5b95',fontSize:'0.85rem'}}>Ø³Ø¤Ø§Ù„ {qIdx+1}/{qWords.length}</span>
                      <div style={{flex:1,maxWidth:200,height:8,background:d?'#2d2050':'#e8d5ff',borderRadius:4,overflow:'hidden'}}>
                        <div style={{width:`${((qIdx+1)/qWords.length)*100}%`,height:'100%',background:'#4d96ff',borderRadius:4,transition:'width .4s'}}/>
                      </div>
                      <span style={S.pill('#e3f2fd','#1565c0')}>â­{qScore}</span>
                    </div>
                    <div style={{fontWeight:800,color:d?'#c9b8ff':'#6b5b95',marginBottom:6}}>ğŸ¤” Ø§ÙŠÙ‡ Ù…Ø¹Ù†Ù‰...</div>
                    <div style={{fontSize:'4rem',margin:'10px 0',animation:'pop .4s ease'}}>{w.e}</div>
                    <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'2.2rem',color:'#4d96ff',marginBottom:18}}>{w.en}</div>
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
                      {qOpts.map((o,i)=>{
                        let bg=d?'#1e1638':'#f3eeff', br=d?'#2d2050':'#e8d5ff';
                        if(picked){ if(o.en===w.en){bg='#6bcb77';br='#6bcb77';} else if(o.en===picked){bg='#ff6b6b';br='#ff6b6b';} }
                        return (
                          <button key={i} disabled={!!picked} onClick={()=>pickAnswer(o)}
                            style={{padding:14,borderRadius:14,border:`3px solid ${br}`,background:bg,cursor:picked?'default':'pointer',
                              fontWeight:800,fontSize:'1rem',fontFamily:"'Fredoka One',cursive",
                              color:picked&&(o.en===w.en||o.en===picked)?'#fff':(d?'#f0e6ff':'#2d1b69'),transition:'all .2s'}}>
                            {o.ar}
                          </button>
                        );
                      })}
                    </div>
                    {picked && (
                      <div style={{marginTop:14,fontWeight:800,fontSize:'1.1rem',animation:'fadeUp .3s ease',color:picked===w.en?'#6bcb77':'#ff6b6b'}}>
                        {picked===w.en?'ğŸ‰ ØµØ­! Ø£Ù†Øª Ø¹Ø¨Ù‚Ø±ÙŠ!':`âŒ Ø§Ù„ØµØ­: ${w.ar} â€” ${w.en} ğŸ’ª`}
                      </div>
                    )}
                  </>
                );
              })()}
              {qState==='done' && (
                <>
                  <div style={{fontSize:'4rem',marginBottom:14,animation:'pop .5s ease'}}>ğŸ†</div>
                  <div style={{fontFamily:"'Fredoka One',cursive",fontSize:'1.5rem',marginBottom:8}}>Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</div>
                  <div style={{fontSize:'2rem',fontWeight:900,color:'#6bcb77',margin:'14px 0'}}>{qScore}/{qWords.length} â­</div>
                  <div style={{fontWeight:700,color:d?'#c9b8ff':'#6b5b95',marginBottom:16}}>
                    {qScore>=9?'ğŸ‰ Ù…Ù…ØªØ§Ø²!':qScore>=7?'ğŸ˜Š ÙƒÙˆÙŠØ³ Ø¬Ø¯Ø§Ù‹!':qScore>=5?'ğŸ’ª ØªØ¯Ø±Ø¨ Ø£ÙƒØªØ±!':'ğŸ“š Ø°Ø§ÙƒØ± ÙˆØ­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ!'}
                  </div>
                  <div style={{display:'flex',gap:10,justifyContent:'center',flexWrap:'wrap'}}>
                    <button className="tbtn" style={S.btn('linear-gradient(135deg,#4d96ff,#845ef7)','0 4px 14px rgba(77,150,255,.4)')} onClick={startQuiz}>ğŸ”„ ØªØ§Ù†ÙŠ!</button>
                    <button className="tbtn" style={S.btn('linear-gradient(135deg,#ff6b6b,#ffd93d)','0 4px 14px rgba(255,107,107,.4)')} onClick={()=>setTab('words')}>ğŸ“š ÙƒÙ„Ù…Ø§Øª</button>
                  </div>
                </>
              )}
            </div>
          )}

          <div style={{textAlign:'center',marginTop:20,color:d?'#c9b8ff':'#6b5b95',fontSize:'0.75rem',fontWeight:700}}>
            ğŸ“ Super English Kids â€” Made with â¤ï¸ for Egyptian children
          </div>

        </div>
      </>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>